{"version":3,"file":"index-798baf75.js","sources":["../../../util/index.ts"],"sourcesContent":["import { ChangeEvent, useEffect, useRef, useState } from 'react'\nimport axios from 'axios'\nimport { format } from 'date-fns'\nimport { LatLng } from '@findus-org/types'\nimport { CaseQuery, ReportType } from '@findus-org/network/src/generated'\n\nimport { notification$ } from './subjects'\nimport { storage } from '@findus-org/network/src/config/firebase'\nimport { getDownloadURL, ref, uploadBytesResumable } from 'firebase/storage'\n\nexport const useImageUpload = () => {\n  const [uploading, setUploading] = useState(false)\n  const [percent, setPercent] = useState(0)\n\n  const handleUpload = async (files: any): Promise<string[]> => {\n    if (!files?.length) {\n      notification$.next({\n        message: 'Images empty.',\n        type: 'error',\n      })\n      return []\n    }\n\n    setUploading(true)\n\n    const uploadTasks = Array.from(files).map((file: any) => {\n      const storageRef = ref(storage, `/files/${file.name}`)\n      const uploadTask = uploadBytesResumable(storageRef, file)\n\n      return new Promise<string>((resolve, reject) => {\n        uploadTask.on(\n          'state_changed',\n          (snapshot) => {\n            const percent = Math.round(\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100,\n            )\n            setPercent(percent)\n          },\n          reject,\n          () => {\n            getDownloadURL(uploadTask.snapshot.ref).then(resolve).catch(reject)\n          },\n        )\n      })\n    })\n\n    try {\n      const imageUrls = await Promise.all(uploadTasks)\n      notification$.next({ message: `Image uploaded.` })\n      setUploading(false)\n      return imageUrls\n    } catch (err) {\n      console.log(err)\n      setUploading(false)\n      return []\n    }\n  }\n\n  return [{ uploading, percent }, handleUpload] as const\n}\n\nexport const useKeypress = (keys: string[], action: () => void) => {\n  useEffect(() => {\n    const onKeyup = (e: { key: any }) => {\n      if (keys.includes(e.key)) action()\n    }\n    window.addEventListener('keyup', onKeyup)\n    return () => window.removeEventListener('keyup', onKeyup)\n  }, [action, keys])\n}\n\nexport const makeId = (length: number = 4) => {\n  var result = ''\n  var characters =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n  var charactersLength = characters.length\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength))\n  }\n  return result\n}\n\nexport const getDistanceFromLatLonInKm = ({\n  from,\n  to,\n}: {\n  from: { lat: number; lng: number }\n  to: { lat: number; lng: number }\n}) => {\n  const deg2rad = (deg: number) => {\n    return deg * (Math.PI / 180)\n  }\n  var R = 6371 // Radius of the earth in km\n  var dLat = deg2rad(to.lat - from.lat) // deg2rad below\n  var dLon = deg2rad(to.lng - from.lng)\n  var a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(deg2rad(from.lat)) *\n      Math.cos(deg2rad(to.lat)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2)\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n  var d = R * c // Distance in km\n  return d\n}\n\nexport const getDistance = async (origin: LatLng, destination: LatLng) => {\n  if (!origin || !destination) {\n    return\n  }\n  const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${origin.lng},${origin.lat};${destination.lng},${destination.lat}?access_token=${process.env.NEXT_PUBLIC_MAPBOX_TOKEN}`\n\n  try {\n    const response = await axios.get(url)\n    const data = response.data\n\n    const distance = data.routes[0].distance // distance in meters\n\n    return distance / 1000 // convert to kilometers\n  } catch (error) {\n    console.error(error)\n  }\n}\n\nexport const toLocalISOString = (date: Date): string => {\n  const tzoffset = date.getTimezoneOffset() * 60000 // offset in milliseconds\n  const localISOTime = new Date(date.getTime() - tzoffset).toISOString()\n  // .slice(0, -1)\n\n  return localISOTime\n}\n\nexport const convertReportsToCoordinates = (\n  reports?: NonNullable<CaseQuery['case']>['reports'],\n): [number, number][] => {\n  // Todo: Ugly type assertion hack.\n  return (\n    reports\n      ?.filter((report) => report.location)\n      .filter((report) => report.type === ReportType.Sighting)\n      .map((report) => [\n        report.location!.longitude,\n        report.location!.latitude,\n      ]) || []\n  )\n}\n\nexport const TAKE_COUNT = 12\nexport const useTakeSkip = (initialSkip = 0, initialTake = TAKE_COUNT) => {\n  const [skip, setSkip] = useState(() => initialSkip)\n  const [take, setTake] = useState(() => initialTake)\n\n  return { take, skip, setTake, setSkip }\n}\n"],"names":["useImageUpload","uploading","setUploading","useState","percent","setPercent","files","notification$","uploadTasks","file","storageRef","ref","storage","uploadTask","uploadBytesResumable","resolve","reject","snapshot","getDownloadURL","imageUrls","err","useKeypress","keys","action","useEffect","onKeyup","e","makeId","length","result","characters","charactersLength","i","TAKE_COUNT","useTakeSkip","initialSkip","initialTake","skip","setSkip","take","setTake"],"mappings":"+KAUO,MAAMA,EAAiB,IAAM,CAClC,KAAM,CAACC,EAAWC,CAAY,EAAIC,WAAS,EAAK,EAC1C,CAACC,EAASC,CAAU,EAAIF,WAAS,CAAC,EA8CxC,MAAO,CAAC,CAAE,UAAAF,EAAW,QAAAG,GA5CA,MAAOE,GAAkC,CACxD,GAAA,EAACA,GAAA,MAAAA,EAAO,QACV,OAAAC,EAAc,KAAK,CACjB,QAAS,gBACT,KAAM,OAAA,CACP,EACM,GAGTL,EAAa,EAAI,EAEjB,MAAMM,EAAc,MAAM,KAAKF,CAAK,EAAE,IAAKG,GAAc,CACvD,MAAMC,EAAaC,EAAIC,EAAS,UAAUH,EAAK,IAAI,EAAE,EAC/CI,EAAaC,EAAqBJ,EAAYD,CAAI,EAExD,OAAO,IAAI,QAAgB,CAACM,EAASC,IAAW,CACnCH,EAAA,GACT,gBACCI,GAAa,CACZ,MAAMb,EAAU,KAAK,MAClBa,EAAS,iBAAmBA,EAAS,WAAc,GAAA,EAEtDZ,EAAWD,CAAO,CACpB,EACAY,EACA,IAAM,CACWE,EAAAL,EAAW,SAAS,GAAG,EAAE,KAAKE,CAAO,EAAE,MAAMC,CAAM,CACpE,CAAA,CACF,CACD,CAAA,CACF,EAEG,GAAA,CACF,MAAMG,EAAY,MAAM,QAAQ,IAAIX,CAAW,EAC/C,OAAAD,EAAc,KAAK,CAAE,QAAS,iBAAmB,CAAA,EACjDL,EAAa,EAAK,EACXiB,QACAC,EAAK,CACZ,eAAQ,IAAIA,CAAG,EACflB,EAAa,EAAK,EACX,EACT,CAAA,CAG0C,CAC9C,EAEamB,EAAc,CAACC,EAAgBC,IAAuB,CACjEC,EAAAA,UAAU,IAAM,CACR,MAAAC,EAAWC,GAAoB,CAC/BJ,EAAK,SAASI,EAAE,GAAG,GAAUH,GAAA,EAE5B,cAAA,iBAAiB,QAASE,CAAO,EACjC,IAAM,OAAO,oBAAoB,QAASA,CAAO,CAAA,EACvD,CAACF,EAAQD,CAAI,CAAC,CACnB,EAEaK,EAAS,CAACC,EAAiB,IAAM,CAK5C,QAJIC,EAAS,GACTC,EACF,iEACEC,EAAmBD,EAAW,OACzBE,EAAI,EAAGA,EAAIJ,EAAQI,IAChBH,GAAAC,EAAW,OAAO,KAAK,MAAM,KAAK,OAAO,EAAIC,CAAgB,CAAC,EAEnE,OAAAF,CACT,EAmEaI,EAAa,GACbC,EAAc,CAACC,EAAc,EAAGC,EAAcH,IAAe,CACxE,KAAM,CAACI,EAAMC,CAAO,EAAInC,EAAAA,SAAS,IAAMgC,CAAW,EAC5C,CAACI,EAAMC,CAAO,EAAIrC,EAAAA,SAAS,IAAMiC,CAAW,EAElD,MAAO,CAAE,KAAAG,EAAM,KAAAF,EAAM,QAAAG,EAAS,QAAAF,CAAQ,CACxC"}