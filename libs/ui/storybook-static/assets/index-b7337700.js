import{r as t}from"./index-76fb7be0.js";const S=t.createContext(null),$=typeof document<"u",w=$?t.useLayoutEffect:t.useEffect,k=t.createContext({});function B(n){const r=t.useRef(null);return r.current===null&&(r.current=n()),r.current}const K=n=>n;function T(n){let r=[],e=[],s=0,u=!1,l=!1;const d=new WeakSet,f={schedule:(a,i=!1,c=!1)=>{const o=c&&u,p=o?r:e;return i&&d.add(a),p.indexOf(a)===-1&&(p.push(a),o&&u&&(s=r.length)),a},cancel:a=>{const i=e.indexOf(a);i!==-1&&e.splice(i,1),d.delete(a)},process:a=>{if(u){l=!0;return}if(u=!0,[r,e]=[e,r],e.length=0,s=r.length,s)for(let i=0;i<s;i++){const c=r[i];c(a),d.has(c)&&(f.schedule(c),n())}u=!1,l&&(l=!1,f.process(a))}};return f}const P=["prepare","read","update","preRender","render","postRender"],U=40;function b(n,r){let e=!1,s=!0;const u={delta:0,timestamp:0,isProcessing:!1},l=P.reduce((o,p)=>(o[p]=T(()=>e=!0),o),{}),d=o=>l[o].process(u),f=o=>{e=!1,u.delta=s?1e3/60:Math.max(Math.min(o-u.timestamp,U),1),u.timestamp=o,u.isProcessing=!0,P.forEach(d),u.isProcessing=!1,e&&r&&(s=!1,n(f))},a=()=>{e=!0,s=!0,u.isProcessing||n(f)};return{schedule:P.reduce((o,p)=>{const R=l[p];return o[p]=(x,C=!1,g=!1)=>(e||a(),R.schedule(x,C,g)),o},{}),cancel:o=>P.forEach(p=>l[p].cancel(o)),state:u,steps:l}}const{schedule:q,cancel:J,state:Q,steps:X}=b(typeof requestAnimationFrame<"u"?requestAnimationFrame:K,!0);function I(){const n=t.useRef(!1);return w(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function D(){const n=I(),[r,e]=t.useState(0),s=t.useCallback(()=>{n.current&&e(r+1)},[r]);return[t.useCallback(()=>q.postRender(s),[s]),r]}class N extends t.Component{getSnapshotBeforeUpdate(r){const e=this.props.childRef.current;if(e&&r.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=e.offsetHeight||0,s.width=e.offsetWidth||0,s.top=e.offsetTop,s.left=e.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function W({children:n,isPresent:r}){const e=t.useId(),s=t.useRef(null),u=t.useRef({width:0,height:0,top:0,left:0});return t.useInsertionEffect(()=>{const{width:l,height:d,top:f,left:a}=u.current;if(r||!s.current||!l||!d)return;s.current.dataset.motionPopId=e;const i=document.createElement("style");return document.head.appendChild(i),i.sheet&&i.sheet.insertRule(`
          [data-motion-pop-id="${e}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${d}px !important;
            top: ${f}px !important;
            left: ${a}px !important;
          }
        `),()=>{document.head.removeChild(i)}},[r]),t.createElement(N,{isPresent:r,childRef:s,sizeRef:u},t.cloneElement(n,{ref:s}))}const M=({children:n,initial:r,isPresent:e,onExitComplete:s,custom:u,presenceAffectsLayout:l,mode:d})=>{const f=B(G),a=t.useId(),i=t.useMemo(()=>({id:a,initial:r,isPresent:e,custom:u,onExitComplete:c=>{f.set(c,!0);for(const o of f.values())if(!o)return;s&&s()},register:c=>(f.set(c,!1),()=>f.delete(c))}),l?void 0:[e]);return t.useMemo(()=>{f.forEach((c,o)=>f.set(o,!1))},[e]),t.useEffect(()=>{!e&&!f.size&&s&&s()},[e]),d==="popLayout"&&(n=t.createElement(W,{isPresent:e},n)),t.createElement(S.Provider,{value:i},n)};function G(){return new Map}function H(n){return t.useEffect(()=>()=>n(),[])}const E=n=>n.key||"";function V(n,r){n.forEach(e=>{const s=E(e);r.set(s,e)})}function _(n){const r=[];return t.Children.forEach(n,e=>{t.isValidElement(e)&&r.push(e)}),r}const Y=({children:n,custom:r,initial:e=!0,onExitComplete:s,exitBeforeEnter:u,presenceAffectsLayout:l=!0,mode:d="sync"})=>{const f=t.useContext(k).forceRender||D()[0],a=I(),i=_(n);let c=i;const o=t.useRef(new Map).current,p=t.useRef(c),R=t.useRef(new Map).current,x=t.useRef(!0);if(w(()=>{x.current=!1,V(i,R),p.current=c}),H(()=>{x.current=!0,R.clear(),o.clear()}),x.current)return t.createElement(t.Fragment,null,c.map(m=>t.createElement(M,{key:E(m),isPresent:!0,initial:e?void 0:!1,presenceAffectsLayout:l,mode:d},m)));c=[...c];const C=p.current.map(E),g=i.map(E),z=C.length;for(let m=0;m<z;m++){const h=C[m];g.indexOf(h)===-1&&!o.has(h)&&o.set(h,void 0)}return d==="wait"&&o.size&&(c=[]),o.forEach((m,h)=>{if(g.indexOf(h)!==-1)return;const F=R.get(h);if(!F)return;const L=C.indexOf(h);let y=m;if(!y){const v=()=>{R.delete(h),o.delete(h);const A=p.current.findIndex(O=>O.key===h);if(p.current.splice(A,1),!o.size){if(p.current=i,a.current===!1)return;f(),s&&s()}};y=t.createElement(M,{key:E(F),isPresent:!1,onExitComplete:v,custom:r,presenceAffectsLayout:l,mode:d},F),o.set(h,y)}c.splice(L,0,y)}),c=c.map(m=>{const h=m.key;return o.has(h)?m:t.createElement(M,{key:E(m),isPresent:!0,presenceAffectsLayout:l,mode:d},m)}),t.createElement(t.Fragment,null,o.size?c:c.map(m=>t.cloneElement(m)))};export{Y as A,k as L,S as P,B as a,Q as b,J as c,q as f,$ as i,K as n,X as s,w as u};
//# sourceMappingURL=index-b7337700.js.map
