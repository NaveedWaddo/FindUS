import{j as e}from"./jsx-runtime-ffb262ed.js";import{L as w}from"./link-8fb8b7fe.js";import{z as g,u as I,t as T}from"./index-80b30449.js";import{r as f}from"./index-76fb7be0.js";import{u as b}from"./exports-mapbox-5254a25e.js";import{B as j}from"./Button-5075d3c0.js";import{a as M,M as C}from"./TimelineItem-455f51ac.js";import{c as D,n as N,d as k}from"./index-422d7130.js";import"./index-545830e9.js";import{D as q}from"./Dialog-f6b3917e.js";import{H as P}from"./HtmlLabel-7b6b9606.js";import{H as R}from"./HtmlInput-c822fede.js";import{A as V}from"./Accordion-ff6330dd.js";import{a as S,s as L}from"./index-95a7abba.js";import{f as p}from"./index-f4466fa7.js";import{P as A}from"./PlainButton-b2040916.js";import{c as O}from"./createReactComponent-d5b921f8.js";import{F}from"./Form-d45ff289.js";const Q=g.object({description:g.string().optional()}),E=()=>I({resolver:T(Q)});var H=O("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]);try{MyTimelineItem.displayName="MyTimelineItem",MyTimelineItem.__docgenInfo={description:"",displayName:"MyTimelineItem",props:{type:{defaultValue:null,description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"GENERAL_INFORMATION"'},{value:'"LEAD"'},{value:'"SIGHTING"'}]}}}}}catch{}try{MyTimeline.displayName="MyTimeline",MyTimeline.__docgenInfo={description:"",displayName:"MyTimeline",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"Ref<unknown>"}}}}}catch{}try{Dialog.displayName="Dialog",Dialog.__docgenInfo={description:"",displayName:"Dialog",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},setOpen:{defaultValue:null,description:"",name:"setOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},widthClassName:{defaultValue:{value:"max-w-md"},description:"",name:"widthClassName",required:!1,type:{name:"string"}}}}}catch{}const v=({reports:i})=>{let l=f.useMemo(()=>i==null?void 0:i.reduce((n,s)=>{let t=s.time.split("T")[0];return n[t]||(n[t]=[]),n[t].push(s),n},{}),[i]);const{current:a}=b();return e.jsx(e.Fragment,{children:Object.entries(l||{}).map(([n,s])=>e.jsxs("div",{className:"pt-3",children:[e.jsx("div",{className:"text-center text-black ",children:p(new Date(n),"PP")}),e.jsx(M,{className:"text-black",children:s==null?void 0:s.map(t=>{var o,d,c,x,h,_;return e.jsxs(C,{type:t.type,children:[e.jsx("div",{children:e.jsx("div",{className:"text-lg",children:p(new Date(t.time),"p")})}),e.jsx("div",{className:"flex flex-col gap-2",children:(o=t.approvedReport)!=null&&o.id?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{children:t.description}),e.jsx("div",{className:"text-xs text-gray",children:(d=t.witness)==null?void 0:d.name})]}),(c=t.location)!=null&&c.latitude?e.jsx(A,{className:"flex items-center justify-center w-6 h-6 gap-2 border rounded-full hover:shadow-lg",onClick:()=>{var r,m;a==null||a.flyTo({center:[((r=t.location)==null?void 0:r.longitude)||0,((m=t.location)==null?void 0:m.latitude)||0],essential:!0})},children:e.jsx(H,{className:"w-5 h-5"})}):null]}),e.jsxs("div",{children:[e.jsx("div",{children:(x=t.approvedReport)==null?void 0:x.description}),e.jsx("div",{className:"text-xs text-gray",children:"Officer report"})]}),e.jsx("div",{children:t.audio?e.jsx("audio",{src:t.audio,controls:!0}):null}),e.jsxs(V,{title:`Comments (${(h=t.comments)==null?void 0:h.length})`,children:[(_=t.comments)==null?void 0:_.map(r=>{var m;return e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{children:r.content}),e.jsx("div",{className:"text-xs text-gray",children:(m=r.witness)==null?void 0:m.name}),e.jsx("div",{className:"text-xs text-gray",children:p(new Date(r.createdAt),"PPp")})]},r.id)}),e.jsx(y,{report:t})]})]}):e.jsxs("div",{children:[e.jsx("div",{children:t.description}),e.jsx(u,{report:t})]})})]},t.id)})})]},n))})},u=({report:i})=>{const[l,a]=f.useState(!1),[n,{data:s,loading:t}]=D(),{register:o,handleSubmit:d}=E();return e.jsxs("div",{className:"py-1",children:[e.jsx(A,{className:"underline underline-offset-4",onClick:()=>a(!0),children:"Approve"}),e.jsxs(q,{open:l,setOpen:a,title:"Approve",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:p(new Date(i.time),"PPp")}),e.jsx("div",{children:i.description})]}),e.jsxs(F,{onSubmit:d(async({description:c})=>{await n({variables:{createApprovedReportInput:{description:c,id:i.id}},awaitRefetchQueries:!0,refetchQueries:[N.Query.case]})}),children:[e.jsx(P,{title:"Description",children:e.jsx(R,{placeholder:"Description...",...o("description")})}),e.jsx(j,{isLoading:t,type:"submit",children:"Approve"})]})]})]})},y=({report:i})=>{const[l,{data:a,loading:n}]=k(),[s,t]=f.useState();return S(L)?e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(R,{placeholder:"Add comment...",value:s,onChange:d=>t(d.target.value)}),s?e.jsx(j,{onClick:async()=>{await l({variables:{createCommentInput:{content:s,reportId:i.id}},awaitRefetchQueries:!0,refetchQueries:[N.Query.case]})},isLoading:n,children:"Add comment"}):null]}):e.jsx(w,{className:"inline-block my-2",href:"/login",children:"Login to add comment."})};try{v.displayName="ReportsTimeline",v.__docgenInfo={description:"",displayName:"ReportsTimeline",props:{reports:{defaultValue:null,description:"",name:"reports",required:!1,type:{name:'{ __typename?: "Report"; time?: any; id: number; type: ReportType; audio?: string | null; description: string; witness?: { __typename?: "Witness" | undefined; uid: string; name?: string | ... 1 more ... | undefined; } | null | undefined; comments?: { ...; }[] | ... 1 more ... | undefined; app...'}}}}}catch{}try{u.displayName="ApproveReport",u.__docgenInfo={description:"",displayName:"ApproveReport",props:{report:{defaultValue:null,description:"",name:"report",required:!0,type:{name:'{ __typename?: "Report" | undefined; time?: any; id: number; type: ReportType; audio?: string | null | undefined; description: string; witness?: { __typename?: "Witness" | undefined; uid: string; name?: string | ... 1 more ... | undefined; } | null | undefined; comments?: { ...; }[] | ... 1 more ... | undefined; app...'}}}}}catch{}try{y.displayName="AddComment",y.__docgenInfo={description:"",displayName:"AddComment",props:{report:{defaultValue:null,description:"",name:"report",required:!0,type:{name:'{ __typename?: "Report" | undefined; time?: any; id: number; type: ReportType; audio?: string | null | undefined; description: string; witness?: { __typename?: "Witness" | undefined; uid: string; name?: string | ... 1 more ... | undefined; } | null | undefined; comments?: { ...; }[] | ... 1 more ... | undefined; app...'}}}}}catch{}export{v as R};
//# sourceMappingURL=ReportsTimeline-cc6c9f7e.js.map
